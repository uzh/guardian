(rule
  (target test_db.sqlite3)
  (deps init_db.sql)
  (action
    (with-stdin-from init_db.sql
      (run sqlite3 -batch %{target}))))

(test
  (name main)
  (libraries alcotest ocaml_authorize sqlite3)
  (preprocess (pps ppx_deriving.make ppx_deriving.show))
  (deps
    article.ml
    hacker.ml
    test_db.sqlite3
    main.ml
    ocauth_store.ml
    user.ml)
  (action
    (progn
      (run chmod u+w test_db.sqlite3)
      (run %{test} -e))))
