<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>index (guardian.index)</title><meta charset="utf-8"/><link rel="stylesheet" href="../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ guardian</nav><header class="odoc-preamble"><h1 id="guardian"><a href="#guardian" class="anchor"></a>Guardian</h1><p>Generic framework for roles and permissions to be used in our projects</p></header><nav class="odoc-toc"><ul><li><a href="#limitations-and-notes">Limitations and Notes</a></li><li><a href="#mysection">Setup with MariaDB backend (MultiPools)</a></li><li><a href="#api">API</a></li></ul></nav><div class="odoc-content"><h2 id="limitations-and-notes"><a href="#limitations-and-notes" class="anchor"></a>Limitations and Notes</h2><ul><li><b>Supported Database</b>: Implementation with MariaDb</li><li><b>Context (`ctx`)</b>: Allows to have multiple database pools <a href="#mysection" title="mysection">Setup with MariaDB backend (MultiPools)</a> (See <a href="test">next section</a>)</li></ul><h2 id="mysection"><a href="#mysection" class="anchor"></a>Setup with MariaDB backend (MultiPools)</h2><pre class="language-ocaml"><code>let open Guardian_backend.Pools in
let module MariaConfig = struct
  include DefaultConfig

  let database =
    MultiPools
      [ &quot;pool-one&quot;, &quot;mariadb://root@database:3306/dev&quot;
      ; &quot;pool-two&quot;, &quot;mariadb://root@database:3306/test&quot;
      ]
  ;;
end
in
let module MariaDb = Guardian_backend.MariaDb.Make (Roles) (Make (MariaConfig))
let%lwt () = Lwt_list.iter (fun pool -&gt; MariaDb.migrate ~ctx:[&quot;pool&quot;, pool] ()) [&quot;pool-one&quot;; &quot;pool-two&quot;]
(** NOTE: To integrate migrations into your applications migration state see
    e.g. function 'MariaDB.find_migrations *)</code></pre><p>## Usage</p><p>The <code>test</code> directory shows an example implementation of how guardian can be used.</p><ul><li><b><code>role.ml</code></b> : Definition of actors and targets</li><li><b><code>role.mli</code></b> : Signature of the defined actors and targets</li><li><b><code>guard.ml</code></b> : Create the guardian service</li><li><b><code>article.ml</code></b> : Definition of the article target</li><li><b><code>hacker.ml</code></b> : Definition of the hacker actor</li><li><b><code>user.ml</code></b> : Definition of the user actor and target</li><li><b><code>main.ml</code></b> : implementation of all test cases</li></ul><p>Example usage:</p><pre class="language-ocaml"><code>module Guard = Guardian.Make (Role.Actor) (Role.Target)

let thomas = &quot;Thomas&quot;, Guard.Uuid.Actor.create ()
let mike = &quot;Mike&quot;, Guard.Uuid.Actor.create ()

let thomas_article = Article.make &quot;Foo&quot; &quot;Bar&quot; thomas
let mike_article = Article.make &quot;Hello&quot; &quot;World&quot; mike

let example_rule = `Actor (snd mike), `Update, `Target thomas_article.uuid

let initialize_authorizables_and_rules ?ctx =
  (* Note: As a user can be an actor and a target, both need to be initialized *)
  let* (_: [&gt; `User ] MariaDb.actor) = User.to_authorizable ?ctx thomas in
  let* (_: [&gt; `User ] MariaDb.actor) = User.to_authorizable ?ctx mike in
  let* (_: [&gt; `User ] MariaDb.target) = UserTarget.to_authorizable ?ctx thomas in
  let* (_: [&gt; `User ] MariaDb.target) = UserTarget.to_authorizable ?ctx mike in
  let* (_: [&gt; `Article ] MariaDb.target) = Article.to_authorizable ?ctx thomas_article in
  let* (_: [&gt; `Article ] MariaDb.target) = Article.to_authorizable ?ctx mike_article in
  let* () = MariaDb.Rule.save ?ctx example_role in
  Lwt.return_unit

(* let mike Update the title of thomas article -&gt; returns a (Article.t, string) Lwt_result.t  *)
let update_title = Article.update_title ?ctx mike thomas_article &quot;Updated Title&quot;</code></pre><h2 id="api"><a href="#api" class="anchor"></a>API</h2><ul class="modules"><li><a href="Guardian/index.html"><code>Guardian</code></a> </li><li><a href="Guardian_backend/index.html"><code>Guardian_backend</code></a> </li></ul></div></body></html>
